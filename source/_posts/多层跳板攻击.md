---
title: 多层跳板攻击
tags: 红蓝对抗
categories: 内网渗透
top: 16
---
## 前言
首先，我们在上一章的基础上，即在Windows Server2003的主机上又发现了另一层的网络，所以我们就必须在以win2003为跳板机，再去访问下一个网段的主机，即多层跳板攻击。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327210912305.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)

## 攻击过程
我们这里使用一台Linux主机为另一个服务器，并设置一个新的网段来进行隔离，原理和上一章的差不多
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327205851533.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
<!--more-->
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327205912717.png)
查看win2003时发现新的网段
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327210026616.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
然后我们使用`arp_scan`模块扫描出更多的主机
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327210311904.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
更新路由表并打印出来
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327210448179.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
<!--more-->
然后我们再新开一个`socks4a`代理，并使用`jobs`命令查看任务，因为之前使用了1080这个端口，因此我们端口必须要重新设置一个新的
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327210638543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327210651264.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
接着我们使用相同的方法，使用`proxychains`对目标主机服务进行探测，首先我们得先配置proxychains配置文件
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327211730108.png)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327210833369.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
发现目标主机开放了22,80,139,445端口
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327211024186.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
我们可以用之前章节使用的密码爆破的方法将主机的用户名和密码都爆破出来，因为我们这里使用的是`metasploitable2`靶机，默认用户名和密码是`msfadmin`，我们用proxychains登录其主机中
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327211353615.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327211430264.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
从上面我们也发现目标主机开启了80端口服务，因此我们也能从网页的形式进一步渗透目标主机，但是浏览器上要设置相应的代理，因为目标网段本身不对外开放，这里我使用的是FoxyProxy这个浏览器代理插件
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327211938831.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)
访问成功
![在这里插入图片描述](https://img-blog.csdnimg.cn/20210327212023570.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTAwNzA3Mw==,size_16,color_FFFFFF,t_70)

## 总结
现在我们对整个入侵思路进行一个总结。首先我们先使用kali攻击机，在本公司的防火墙上设置好NAT端口映射，目的是为了接受目标机反弹回来的shell，当我们对其中一台目标机①掌握了控制权后，我们在这台主机上发现了另一个网段(`104`网段吧)，然后我们以主机①为跳板机，去访问104网段，我们使用proxychains工具隐藏自己的真实访问IP，然后拿下主机②时，又发现另一个网段时，用相同的方法进行横向，多层跳板攻击的过程。
